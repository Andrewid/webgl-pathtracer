<!DOCTYPE html>
<!--
/**
 * @author Raoul Harel
 * @license The MIT license (LICENSE.txt)
 * @copyright 2015 Raoul Harel
 * @url https://github.com/rharel/webgl-pathtracer
 */
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cornell Box Example [webgl-pathtracer]</title>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="../bower_components/three.js/build/three.js"></script>

    <link rel="stylesheet" href="example.css">

    <script src="../dist/glpt.js"></script>
    <script src="Postprocessor.js"></script>

    <script>

        $(document).ready(function() {

            var WIDTH = 512, HEIGHT = 512;

            var postprocessor = new Postprocessor(WIDTH, HEIGHT);
            var pathtracer = null;

            function init_pathtracer() {

                var materials = [

                    {
                        type: GLPT.Material.Lambert,
                        color: new THREE.Color('red')
                    },

                    {
                        type: GLPT.Material.Lambert,
                        color: new THREE.Color('orange')
                    },

                    {
                        type: GLPT.Material.Lambert,
                        color: new THREE.Color('yellow')
                    },

                    {
                        type: GLPT.Material.Lambert,
                        color: new THREE.Color(0x00ff00)
                    },

                    {
                        type: GLPT.Material.Lambert,
                        color: new THREE.Color('gray')
                    },

                    {
                        type: GLPT.Material.Lambert,
                        color: new THREE.Color('violet')
                    },

                    {
                        type: GLPT.Material.Lambert,
                        color: new THREE.Color(0xffffff)
                    }
                ];

                var red = 0, orange = 1, yellow = 2, green = 3, blue = 4, violet = 5, white = 6;

                var geometry = [

                    // left wall
                    {
                        shape: {

                            type: GLPT.Primitive.Plane,
                            position: {x: -1, y: 0, z: 0},
                            normal: {x: 1, y: 0, z: 0}
                        },

                        material_index: white //red
                    },

                    // right wall
                    {
                        shape: {

                            type: GLPT.Primitive.Plane,
                            position: {x: 1, y: 0, z: 0},
                            normal: {x: -1, y: 0, z: 0}
                        },

                        material_index: white //orange
                    },

                    // front wall
                    {
                        shape: {

                            type: GLPT.Primitive.Plane,
                            position: {x: 0, y: 0, z: 1},
                            normal: {x: 0, y: 0, z: -1}
                        },

                        material_index: white //yellow
                    },

                    // back wall
                    {
                        shape: {

                            type: GLPT.Primitive.Plane,
                            position: {x: 0, y: 0, z: -1},
                            normal: {x: 0, y: 0, z: 1}
                        },

                        material_index: white //green
                    },

                    // top wall
                    {
                        shape: {

                            type: GLPT.Primitive.Plane,
                            position: {x: 0, y: 1, z: 0},
                            normal: {x: 0, y: -1, z: 0}
                        },

                        material_index: red //blue
                    },

                    // bottom wall
                    {
                        shape: {

                            type: GLPT.Primitive.Plane,
                            position: {x: 0, y: -1, z: 0},
                            normal: {x: 0, y: 1, z: 0}
                        },

                        material_index: white
                    },

                    // sphere A
                    {
                        shape: {

                            type: GLPT.Primitive.Sphere,
                            position: {x: 0.3, y: -0.5, z: -0.5},
                            radius: 0.5
                        },

                        material_index: green
                    }
                ];

                var lighting = [

                    {
                        type: GLPT.Light.Sphere,
                        position: {x: 0.0, y: 0.75, z: 0.0},
                        radius: 0.25,
                        color: {r: 1, g: 1, b: 1},
                        intensity: 6
                    }
                ];

                var scene = {materials: materials, geometry: geometry, lighting: lighting};

                pathtracer = new GLPT.Renderer({

                    canvas: document.getElementById('render-live')
                });

                pathtracer.scene = scene;
                pathtracer.camera.position.set(0, 0, 3);
                pathtracer.camera.rotation.set(0, 0, 0);
                pathtracer.camera.fov = 75;

                pathtracer.update();
            }

            var MAX_RENDER_CALLS = 1000;
            var $render_call_counter = $('#render-call-counter');

            function render_loop() {

                pathtracer.render(postprocessor.input_render_target);

                postprocessor.process(pathtracer.renderer);

                ++ postprocessor.divisor;

                $render_call_counter.text(

                    (postprocessor.divisor - 1) + ' / ' + MAX_RENDER_CALLS
                );

                if (postprocessor.divisor <= MAX_RENDER_CALLS) {

                    requestAnimationFrame(render_loop);
                }
            }

            init_pathtracer();
            pathtracer.renderer.autoClear = false;

            requestAnimationFrame(render_loop);

            //$(document).keyup(function() { requestAnimationFrame(render_loop)});
        });
    </script>
</head>
<body>

    <h3>Render calls: <span id="render-call-counter"></span></h3>

    <canvas id="render-live" width="512" height="512">

        Your browser does not support HTML5 canvas :(
    </canvas>

    <!--<canvas id="render-average" width="512" height="512">-->

        <!--Your browser does not support HTML5 canvas :(-->
    <!--</canvas>-->

    <!--<canvas id="render-reference" width="500" height="500">-->

        <!--Your browser does not support HTML5 canvas :(-->
    <!--</canvas>-->
</body>
</html>